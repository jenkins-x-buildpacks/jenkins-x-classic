extends:
  file: ../pipeline.yaml
agent:
  image: denispalnitskyaurea/pythonextended
pipelines:
  pullRequest:
    build:
      steps:      
      - sh: pip install pytest-cov
        name: python-test-cov-dependency
      - sh: pytest --cov-report html --cov-report xml --cov-report term --cov=.
        name: python-unit-test    
  release:
    setVersion:
      steps:
      - sh: echo \$(jx-release-version) > VERSION
        name: next-version
        comment: so we can retrieve the version in later steps
      # TODO set the version in source?
      - sh: jx step tag --version \$(cat VERSION)
        name: tag-version

    build:
      steps:      
      - sh: pip install pytest-cov
        name: python-test-cov-dependency
      - sh: pytest --cov-report html --cov-report xml --cov-report term --cov=.
        name: python-unit-test